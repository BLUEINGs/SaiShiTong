"use strict";(self["webpackChunkchampation_management_system"]=self["webpackChunkchampation_management_system"]||[]).push([[996],{5996:function(e,t,s){s.r(t),s.d(t,{default:function(){return k}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"meeting-detail"},[t("div",{staticClass:"content-wrapper"},[t("div",{staticClass:"meeting-header"},[t("div",{staticClass:"cover-image"},[t("img",{attrs:{src:e.meetingInfo.img||e.defaultImage,alt:e.meetingInfo.name}})]),t("div",{staticClass:"header-content"},[t("div",{staticClass:"title-container"},[t("h1",[e._v(e._s(e.meetingInfo.name))])]),t("div",{staticClass:"meeting-stats"},[t("el-tag",[e._v(e._s(e.meetingInfo.schoolCount)+"个学校")]),t("el-tag",{attrs:{type:"success"}},[e._v(e._s(e.meetingInfo.sportCount)+"个项目")]),t("el-tag",{attrs:{type:"warning"}},[e._v(e._s(e.meetingInfo.playerCount)+"名运动员")])],1),t("div",{staticClass:"action-buttons"},[t("el-button",{attrs:{type:"primary"},on:{click:e.handleJoin}},[e._v(" 加入运动会 ")]),e.isLoggedIn?e._e():t("el-button",{attrs:{type:e.isFollowed?"success":"info"},on:{click:e.toggleFollow}},[e._v(" "+e._s(e.isFollowed?"已关注":"关注")+" ")])],1)])]),t("el-tabs",{on:{"tab-click":e.handleTabClick},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[t("el-tab-pane",{attrs:{label:"参赛学校",name:"schools"}},[t("department-overview",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.schools,expression:"loading.schools"}],attrs:{schools:e.meetingInfo.schools}})],1),t("el-tab-pane",{attrs:{label:"比赛项目",name:"sports"}},[t("sports-overview",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.sports,expression:"loading.sports"}],attrs:{sports:e.meetingInfo.sports}})],1),t("el-tab-pane",{attrs:{label:"赛程安排",name:"schedule"}},[t("schedule-overview",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.schedule,expression:"loading.schedule"}],attrs:{schedule:e.meetingInfo.schedule}})],1)],1),t("responsive-dialog",{attrs:{title:"加入运动会",visible:e.joinDialogVisible,width:"400px"},on:{"update:visible":function(t){e.joinDialogVisible=t},confirm:e.submitJoin,cancel:function(t){e.joinDialogVisible=!1}}},[t("el-form",{attrs:{model:e.joinForm,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"邀请码",prop:"inviteCode"}},[t("el-input",{attrs:{placeholder:"请输入邀请码"},model:{value:e.joinForm.inviteCode,callback:function(t){e.$set(e.joinForm,"inviteCode",t)},expression:"joinForm.inviteCode"}})],1)],1)],1)],1)])},o=[],i=(s(4114),s(8111),s(2489),s(1701),s(4603),s(7566),s(8721),s(5720)),r=s(6208),n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"department-overview"},[t("el-card",[t("div",{attrs:{slot:"header"},slot:"header"},[t("h3",[e._v("参赛学校概况")]),t("div",{staticClass:"statistics"},[t("el-tag",{attrs:{type:"info"}},[e._v("共"+e._s(e.schools.length)+"个学校")])],1)]),t("div",{staticClass:"schools-list"},[t("el-row",{attrs:{gutter:20}},e._l(e.schools,(function(s){return t("el-col",{key:s.scId,attrs:{span:8}},[t("el-card",{staticClass:"school-card",attrs:{shadow:"hover"}},[t("img",{staticClass:"school-image",attrs:{src:s.img,alt:s.name}}),t("h4",[e._v(e._s(s.name))]),t("div",{staticClass:"school-slogan"},[e._v(e._s(s.slogan))]),t("p",{staticClass:"meta"},[t("span",[e._v(e._s((s.players||[]).length)+"名运动员")])])])],1)})),1)],1)])],1)},l=[],c={name:"DepartmentOverview",props:{schools:{type:Array,default:()=>[]}}},d=c,u=s(1656),g=(0,u.A)(d,n,l,!1,null,"31678bd5",null),m=g.exports,h=function(){var e=this,t=e._self._c;return t("div",{staticClass:"sports-overview"},[t("el-card",[t("div",{attrs:{slot:"header"},slot:"header"},[t("h3",[e._v("项目概况")]),t("div",{staticClass:"statistics"},[t("el-tag",{attrs:{type:"info"}},[e._v("共"+e._s(e.sports.length)+"个项目")])],1)]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.sports}},[t("el-table-column",{attrs:{prop:"name",label:"项目名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.getGenderPrefix(t.row.gender)+t.row.name)+" ")]}}])}),t("el-table-column",{attrs:{prop:"compType",label:"赛段"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:e.getPhaseType(s.row.compType)}},[e._v(" "+e._s(e.getPhaseText(s.row.compType))+" ")])]}}])}),t("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:e.getStatusType(s.row.status)}},[e._v(" "+e._s(e.getStatusText(s.row.status))+" ")])]}}])})],1)],1)],1)},p=[],f={name:"SportsOverview",props:{sports:{type:Array,default:()=>[]}},methods:{getGenderPrefix(e){return!0===e?"男子":!1===e?"女子":""},getPhaseText(e){switch(e){case 1:return"预赛";case 2:return"半决赛";case 3:return"决赛";default:return"未知赛段"}},getPhaseType(e){switch(e){case 1:return"info";case 2:return"warning";case 3:return"success";default:return""}},getStatusType(e){switch(e){case 0:return"info";case 1:return"warning";case 2:return"success";case 3:return"warning";case 4:return"";default:return"info"}},getStatusText(e){switch(e){case 0:return"未开始";case 1:return"报名中";case 2:return"进行中";case 3:return"已评分";case 4:return"已晋级/决胜负";default:return"未知状态"}}}},v=f,w=(0,u.A)(v,h,p,!1,null,"6741e61e",null),y=w.exports,_=function(){var e=this,t=e._self._c;return t("div",{staticClass:"schedule-overview"},[t("el-card",[t("div",{attrs:{slot:"header"},slot:"header"},[t("h3",[e._v("赛程概况")]),t("div",{staticClass:"filter"},[t("el-radio-group",{attrs:{size:"small"},model:{value:e.timeFilter,callback:function(t){e.timeFilter=t},expression:"timeFilter"}},[t("el-radio-button",{attrs:{label:"today"}},[e._v("今日赛程")]),t("el-radio-button",{attrs:{label:"tomorrow"}},[e._v("明日赛程")]),t("el-radio-button",{attrs:{label:"all"}},[e._v("全部赛程")])],1)],1)]),t("el-timeline",e._l(e.filteredSchedule,(function(s){return t("el-timeline-item",{key:s.id,attrs:{type:e.getEventType(s.status),color:e.getEventColor(s.status),timestamp:e.formatTime(s)}},[t("el-card",{staticClass:"event-card"},[t("h4",[e._v(e._s(s.name))]),t("p",{staticClass:"event-info"},[t("span",[e._v(e._s(e.getPhaseText(s.compType)))]),t("el-divider",{attrs:{direction:"vertical"}}),t("span",[e._v(e._s(s.venue||"待定"))])],1),s.gameStartTime&&s.gameEndTime?t("p",{staticClass:"event-time"},[e._v(" "+e._s(e.formatTimeRange(s.gameStartTime,s.gameEndTime))+" ")]):e._e(),t("el-tag",{attrs:{type:e.getStatusType(s.status),size:"small"}},[e._v(" "+e._s(e.getStatusText(s.status))+" ")])],1)],1)})),1)],1)],1)},S=[],b={name:"ScheduleOverview",props:{schedule:{type:Array,default:()=>[]}},data(){return{timeFilter:"today"}},computed:{filteredSchedule(){const e=(new Date).setHours(0,0,0,0),t=e+864e5;return this.schedule.filter((s=>{const a=new Date(s.time).setHours(0,0,0,0);switch(this.timeFilter){case"today":return a===e;case"tomorrow":return a===t;default:return!0}}))}},methods:{formatTime(e){return e.gameStartTime?new Date(e.gameStartTime).toLocaleDateString():"时间待定"},formatTimeRange(e,t){const s=new Date(e),a=new Date(t);return`${s.getHours()}:${String(s.getMinutes()).padStart(2,"0")} - ${a.getHours()}:${String(a.getMinutes()).padStart(2,"0")}`},getEventType(e){return"ongoing"===e?"primary":""},getEventColor(e){const t={pending:"#909399",ongoing:"#409EFF",finished:"#67C23A"};return t[e]||"#909399"},getStatusType(e){const t={0:"info",1:"warning",2:"success",3:"warning",4:""};return t[e]||"info"},getStatusText(e){const t={0:"未开始",1:"报名中",2:"进行中",3:"已评分",4:"已晋级/决胜负"};return t[e]||"未知状态"},getPhaseText(e){const t={1:"预赛",2:"半决赛",3:"决赛"};return t[e]||"未知阶段"}}},I=b,C=(0,u.A)(I,_,S,!1,null,"0aa4cdbf",null),T=C.exports,x={name:"SportMeetingDetail",components:{ResponsiveDialog:r.A,DepartmentOverview:m,SportsOverview:y,ScheduleOverview:T},props:{fromList:{type:Boolean,default:!1},initialData:{type:Object,default:()=>({})}},data(){return{meetingInfo:this.fromList?this.initialData:{schools:[],sports:[],schedule:[]},activeTab:"schools",joinDialogVisible:!1,joinForm:{inviteCode:""},defaultImage:"default-meeting.jpg",loading:{schools:!1,sports:!1,schedule:!1},dataLoaded:{schools:!1,sports:!1,schedule:!1}}},computed:{isLoggedIn(){return!!localStorage.getItem("token")},isFollowed(){if(this.isLoggedIn)return this.meetingInfo.isFollowed;const e=JSON.parse(localStorage.getItem("smIds")||"[]");return e.includes(Number(this.$route.params.id))}},methods:{getRequestConfig(e){return{url:e,method:"get",params:{smId:this.$route.params.id}}},async fetchMeetingInfo(){try{const e=await(0,i.A)({url:`/getSportMeeting/${this.$route.params.id}`,method:"get"});1===e.code&&(this.meetingInfo=e.data)}catch(e){console.error("获取运动会详情失败:",e),this.$message.error("获取运动会详情失败")}},async fetchSchools(){try{const e=await(0,i.A)(this.getRequestConfig("/getSchools"));1===e.code&&(this.meetingInfo.schools=e.data)}catch(e){console.error("获取学校信息失败:",e),this.$message.error("获取学校信息失败")}},async fetchSports(){try{const e=await(0,i.A)(this.getRequestConfig("/getAvailableSports"));1===e.code&&(this.meetingInfo.sports=e.data.map((e=>({id:e.spId,name:e.name,gender:e.gender,compType:e.compType,mainSpId:e.mainSpId,status:e.status}))))}catch(e){console.error("获取比赛项目失败:",e),this.$message.error("获取比赛项目失败")}},async fetchSchedule(){try{const e=await(0,i.A)(this.getRequestConfig("/getSchedules"));1===e.code&&(this.meetingInfo.schedule=e.data)}catch(e){console.error("获取赛程安排失败:",e),this.$message.error("获取赛程安排失败")}},async handleJoin(){this.isLoggedIn?this.joinDialogVisible=!0:this.$confirm("加入运动会需要注册或登录，但您仍然可以点击关注按钮以便无身份查看运动会的开发数据","提示",{confirmButtonText:"去登录",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$router.push("/login")})).catch((()=>{}))},async submitJoin(){try{const e=new URLSearchParams;e.append("smId",this.$route.params.id),e.append("inviteCode",this.joinForm.inviteCode);const t=await(0,i.A)({url:"/joinSportMeeting",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:e});if(1===t.code){const e=await(0,i.A)({url:"/getUserInfo",method:"get"});if(1===e.code){const t=e.data;localStorage.setItem("userInfo",JSON.stringify(t)),window.dispatchEvent(new StorageEvent("storage",{key:"userInfo",newValue:JSON.stringify(t)}))}this.$message.success("加入成功"),this.joinDialogVisible=!1}}catch(e){this.$message.error("加入失败")}},async toggleFollow(){if(!this.isLoggedIn){const e=Number(this.$route.params.id);let t=JSON.parse(localStorage.getItem("smIds")||"[]"),s=Number(localStorage.getItem("currentSmId"));return this.isFollowed?(t=t.filter((t=>t!==e)),s===e&&(s=t.length>0?t[0]:null)):(t.push(e),s=e),localStorage.setItem("smIds",JSON.stringify(t)),localStorage.setItem("currentSmId",s||""),void this.$message.success(this.isFollowed?"取消关注成功":"关注成功")}try{const e=await(0,i.A)({url:"/toggleFollowSportMeeting",method:"post",headers:{SmId:this.$route.params.id}});1===e.code&&(this.meetingInfo.isFollowed=!this.meetingInfo.isFollowed,this.$message.success(this.isFollowed?"关注成功":"取消关注成功"))}catch(e){this.$message.error("操作失败")}},async handleTabClick(e){const t=e.name;if(!this.dataLoaded[t]){this.loading[t]=!0;try{switch(t){case"schools":await this.fetchSchools();break;case"sports":await this.fetchSports();break;case"schedule":await this.fetchSchedule();break}this.dataLoaded[t]=!0}catch(s){console.error(`加载${t}数据失败:`,s)}finally{this.loading[t]=!1}}},async fetchData(){try{await this.fetchMeetingInfo()}catch(e){console.error("获取数据失败:",e),this.$message.error("获取数据失败")}}},mounted(){this.fromList||this.fetchMeetingInfo(),this.handleTabClick({name:"schools"})}},F=x,$=(0,u.A)(F,a,o,!1,null,"346a5f68",null),k=$.exports}}]);
//# sourceMappingURL=996.48ee0549.js.map